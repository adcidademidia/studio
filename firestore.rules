/**
 * @fileoverview Firestore Security Rules for the StreamDeck Lower Thirds application.
 *
 * Core Philosophy:
 * This ruleset prioritizes a strict user-ownership model for private data nested under `/users/{userId}`.
 * Global configurations (themes, lower third configurations) are stored at the root level and may be publicly readable.
 * The active state is stored in a separate collection and is publicly readable and writable for this simple use case.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Checks if the request is made by a signed-in user.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    /**
     * @description Rules for the /activeState/{docId} collection.
     * @path /activeState/{docId}
     * @allow (read, write) Any user can read or write the active state to allow real-time synchronization.
     * @principle Public access for shared state.
     */
    match /activeState/{docId} {
      allow read, write: if true;
    }

    /**
     * @description Rules for the /themes/{themeId} collection.
     * @path /themes/{themeId}
     * @allow (get) Any user can retrieve a theme.
     * @allow (list) Any user can list themes.
     * @deny (create) No user can create a theme.  Themes can only be created by administrator.
     * @principle Allows public read access to themes.
     */
    match /themes/{themeId} {
      allow get: if true;
      allow list: if true;

      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Rules for the /lowerThirdConfigurations/{configurationId} collection.
     * @path /lowerThirdConfigurations/{configurationId}
     * @allow (get) Any user can retrieve a lower third configuration.
     * @allow (list) Any user can list lower third configurations.
     * @deny (create) No user can create a lower third configuration. Configurations can only be created by administrator.
     * @principle Allows public read access to configurations.
     */
    match /lowerThirdConfigurations/{configurationId} {
      allow get: if true;
      allow list: if true;

      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
  }
}
