{
  "entities": {
    "Theme": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Theme",
      "type": "object",
      "description": "Represents a theme with customizable text colors and a background image for the lower third.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Theme entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the theme."
        },
        "textColor": {
          "type": "string",
          "description": "The text color for the lower third."
        },
        "backgroundColor": {
          "type": "string",
          "description": "The background color for the lower third."
        },
        "backgroundImageUrl": {
          "type": "string",
          "description": "URL of the background image for the lower third.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "textColor",
        "backgroundColor"
      ]
    },
    "LowerThirdConfiguration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LowerThirdConfiguration",
      "type": "object",
      "description": "Represents the configuration for a lower third, including music and people sections.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LowerThirdConfiguration entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the configuration."
        },
        "musicItems": {
          "type": "array",
          "description": "List of music items in the configuration.",
          "items": {
            "type": "string"
          }
        },
        "peopleItems": {
          "type": "array",
          "description": "List of people items in the configuration.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "musicItems",
        "peopleItems"
      ]
    },
    "LowerThirdInstance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LowerThirdInstance",
      "type": "object",
      "description": "Represents a specific instance of a lower third, storing the title, subtitle, theme, and target display computer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LowerThirdInstance entity."
        },
        "title": {
          "type": "string",
          "description": "The title text for the lower third."
        },
        "subtitle": {
          "type": "string",
          "description": "The subtitle text for the lower third."
        },
        "themeId": {
          "type": "string",
          "description": "Reference to Theme. (Relationship: Theme 1:N LowerThirdInstance)"
        },
        "targetComputer": {
          "type": "string",
          "description": "The identifier for the computer where the lower third should be displayed."
        },
        "configurationId": {
          "type": "string",
          "description": "Reference to LowerThirdConfiguration. (Relationship: LowerThirdConfiguration 1:N LowerThirdInstance)"
        }
      },
      "required": [
        "id",
        "title",
        "subtitle",
        "themeId",
        "targetComputer",
        "configurationId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection to store user-related data. Serves as an anchor for user-owned subcollections.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/lowerThirdInstances/{instanceId}",
        "definition": {
          "entityName": "LowerThirdInstance",
          "schema": {
            "$ref": "#/backend/entities/LowerThirdInstance"
          },
          "description": "Stores instances of lower thirds configurations specific to a user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "instanceId",
              "description": "The unique identifier for the lower third instance."
            }
          ]
        }
      },
      {
        "path": "/themes/{themeId}",
        "definition": {
          "entityName": "Theme",
          "schema": {
            "$ref": "#/backend/entities/Theme"
          },
          "description": "Collection to store themes for lower thirds.",
          "params": [
            {
              "name": "themeId",
              "description": "The unique identifier for the theme."
            }
          ]
        }
      },
      {
        "path": "/lowerThirdConfigurations/{configurationId}",
        "definition": {
          "entityName": "LowerThirdConfiguration",
          "schema": {
            "$ref": "#/backend/entities/LowerThirdConfiguration"
          },
          "description": "Collection to store configurations for lower thirds.",
          "params": [
            {
              "name": "configurationId",
              "description": "The unique identifier for the lower third configuration."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the StreamDeck Lower Thirds application, focusing on simplicity, security, and scalability.  It provides clear separation of user-specific data and globally shared configurations to ensure efficient data retrieval and management. The data model emphasizes authorization independence through denormalization, avoiding complex hierarchical dependencies in security rules and enabling atomic operations. This architecture facilitates straightforward and robust security rules that are easy to debug. \n\nTo achieve authorization independence (CRITICAL), the structure relies on denormalization, copying relevant authorization context (like user IDs or role memberships) into subcollections. This eliminates the need for `get()` calls in security rules, simplifying rule logic and enabling atomic operations. Each collection is designed with a homogeneous security posture, meaning all documents within a collection share the same security requirements, further simplifying the rules.\n\nThe path-based ownership pattern (`/users/{userId}/...`) secures private user data. Global configurations (themes, configurations) are stored at the root level, as the user story does not describe sharing of global configuration between users or user-based access control. If sharing between users or orgs is required, a membership map should be implemented. \n\n**Authorization Independence:** There is no implicit authorization, it relies solely on `request.auth.uid` and existence checks or explicit fields in the database.\n\n**QAPs Support:**\n\n*   *Private User Data*: The `/users/{userId}` path segregation guarantees that listing `/users/{userId}/lowerThirdInstances` will only return data accessible to the specified user, as enforced by the path-based security rules.\n*   *Global Configurations*: Themes and configurations are placed at the root level with potentially public read access.\n\n"
  }
}